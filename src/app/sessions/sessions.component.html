<!--
  Author: Edgar Butwilowski
  Copyright (c) Fachstelle Geoinformation Winterthur. All rights reserved.

  Sessions view:
  - Top grid: list of sessions (master list)
  - Below: three independent child grids that reflect the currently selected session:
      1) Projects (isRoadworkProject === true)
      2) Present users (isRoadworkProject === false AND isPresent === true)
      3) Distribution list users (isRoadworkProject === false AND isDistributionList === true)
-->

<!-- Hidden container used for report generation (HTML â†’ DOCX/PDF). -->
<div #reportContainer style="position: fixed; left: -9999px; top: 0; visibility: hidden;"></div>


<div style="margin:0;margin-left: 2em;margin-right: 2em;" >
  <div style="margin-bottom: 1em;">
    <h3>
      Sitzungen ({{ sessionsData.length }})      
      <label class="quick-filter" style="display:inline-flex; gap:.5em; align-items:center;">        
        <input
          type="text"
          id="input-quick-filter"
          placeholder="Suchen..."
          (input)="onQuickFilterChanged()"
          style="padding:.35em .5em; width: 16rem;"
        />
      </label>
      </h3>
  </div>
 
  <!-- Loading indicator overlay -->
  <mat-progress-bar *ngIf="isDataLoading" mode="indeterminate" color="primary"></mat-progress-bar>
  
  <div class="grid-overlay" *ngIf="isDataLoading"></div>

  <!-- Master grid: list of sessions (community edition only) -->
  <ag-grid-angular
    class="ag-theme-alpine"
    [rowData]="sessionsData"
    [columnDefs]="sessionsColDefs"
    [defaultColDef]="defaultColDef"
    rowSelection="single"
    [rowHeight]="28"
    [headerHeight]="28"
    [includeHiddenColumnsInQuickFilter]="true" 
    (gridReady)="onSessionsGridReady($event)"
    (selectionChanged)="onSessionSelectionChanged()"
    [attr.inert]="isDataLoading ? '' : null"
    style="width: 100%; height: 20vh;"
  >
  </ag-grid-angular>

  <!-- Child grids container -->
  <div style="display: grid; grid-template-columns: 40fr 32fr 28fr; gap: 1rem; margin-top: 1rem;">
    <h3 style="grid-column: span 3; margin-bottom: .5rem;">      
      <ng-container *ngIf="selectedSession as s">{{ s.sessionName }}</ng-container>
    </h3>
    <!-- Grid 1: Projects -->
    <div>
      <h4 style="margin: .25rem 0;">Bauvorhaben ({{ projectRows.length }})</h4>
      <ag-grid-angular
        #projectsGrid
        class="ag-theme-alpine"
        [rowHeight]="28"
         [headerHeight]="28"
        [rowData]="projectRows"
        [columnDefs]="projectsColDefs"
        [defaultColDef]="childDefaultColDef"        
        style="width: 100%; height:50vh;"
        (firstDataRendered)="autoSizeAll($event)"
      >
      </ag-grid-angular>
    </div>

    <!-- Grid 2: Present users -->
    <div>
      <h4 style="margin: .25rem 0;">Teilnehmerliste ({{ getPresentListCount(presentUserRows) }})</h4>
      <ag-grid-angular
        #presentGrid
        class="ag-theme-alpine"
        [rowHeight]="28"
        [headerHeight]="28"
        [rowData]="presentUserRows"
        [columnDefs]="peopleColDefs"
        [defaultColDef]="childDefaultColDef"
        style="width: 100%; height: 50vh;"
        (firstDataRendered)="autoSizeAll($event)"
      >
      </ag-grid-angular>
    </div>

    <!-- Grid 3: Distribution list users -->
    <div>
      <h4 style="margin: .25rem 0;">E-Mail-Verteiler ({{ getDistributionListCount(distributionUserRows) }})</h4>
      <ag-grid-angular
        #distributionGrid        
        class="ag-theme-alpine"
        [rowHeight]="28"
        [headerHeight]="28"
        [rowData]="distributionUserRows"
        [columnDefs]="distributionColDefs"
        [defaultColDef]="childDefaultColDef"
        style="width: 100%; height: 50vh;"
        (firstDataRendered)="autoSizeAll($event)"
      >
      </ag-grid-angular>
    </div>
  </div>
</div>
